#!/bin/zsh
set -eux -o pipefail

xmodmap -e 'pointer = 1 0 3 4 5 0 0 2 8'

# todo thumb button comes thru keyboard adapter
# so should be possible to remap

mouse=$(xinput --list --id-only 'pointer:Logitech MX Master')

# todo currently configured from windows?
keys=(
    1   # 1 left click
    0   # 2 wheel click
    3   # 3 right click
    4   # 4 wheel forward
    5   # 5 wheel backward
    0   # 6 wheel tilt left
    0   # 7 wheel tilt right
    10  # 8 thumb backward
    0   # 9 thumb forward
    0   # 10 thumb down?
)
xinput --set-button-map $mouse $(seq 20)
#xinput --set-button-map $mouse $keys

#xset m 0 0  # should be linear model for mouse, exponential would be '3 0' or so
xinput --set-prop $mouse 'libinput Accel Profile Enabled' 1 0
xinput --set-prop $mouse 'libinput Accel Speed' 0

# todo works but maps keys, not shortcuts/combinations
#xkbset m  # to allow mouse keycodes, todo ok? what about xkbset exp =m
#xmodmap -e 'keycode 37 = Pointer_Button2 NoSymbol Pointer_Button2'
#xmodmap -e 'keycode 37 = Control_L NoSymbol Control_L'

# todo insert (fn) button sends no code
# todo eject button can be used as modifier?

# for testing keep it in foreground
# could also be done globally if we dont need it per mouse type
xbindkeys -n -f =(cat << 'eof'

"xte 'keydown Control_R' 'key w' 'sleep 0.05' 'keyup Control_R'"
    b:8

# somehow super + w doesnt work
# not even what xbindkeys --key says (Mod2+Mod4 + Super_L) works
#"xte 'mouseclick 2'"
#    Alt + w

eof
)
