#!/bin/zsh
set -eux -o pipefail

# bind an executable to g (split) and G (new window)
# meant to use dynamically for whatever is the current task
# (Maybe gotta be a bit careful because $@ gets expanded more than once?)

cmd='while true; do
    clear
    echo ">" '$@'
    echo
    '$@'
    echo
    echo ">" '$@'
    echo "exit code = $?"
    while true; do
        read -sk "r?[q] to quit or [enter] to rerun:"
        echo
        if [[ $r == q ]]; then
            exit
        fi
        if [[ $r == $'"'"'\n'"'"' ]]; then
            break
        fi
    done
done'

tmux bind-key g split-window -h -c "#{pane_current_path}" zsh -ic $cmd
tmux bind-key G new-window -n g-bound -c "#{pane_current_path}" zsh -ic $cmd
