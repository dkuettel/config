#!/bin/zsh
set -eux -o pipefail

if [[ ! -d /efs ]]; then
    sudo mkdir -p /efs
    sudo chown dkuettel:dkuettel /efs
fi

if mountpoint /efs; then
    echo 'something is already mounted at /efs' >&2
    exit 1
fi

opts='allow_root,reconnect,auto_cache'
# NOTE maybe allow_other instead of allow_root if problems when mapping in to docker

case $(hostname) in
    (boom)
        # NOTE direct ip is much faster, aws ssm is only meant for admin ssh, not for data
        sshfs -o $opts efs@00.000.000.00:/efs /efs
        ;;
    (base)
        sshfs -o $opts efs:/efs /efs
        ;;
    (*)
        echo "unknown local host $(hostname)" >&2
        exit 1
        ;;
esac
