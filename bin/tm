#!/bin/zsh -eux
set -o pipefail

n=${1:?argument 1: session name/folder}

# variables
dev=~/dev/$n
nn=$dev/nn
caffe=$dev/caffe
runs=/data/xps/metric/runs
PYTHONPATH=$nn/python:$nn/libs/liblinear/python:$nn/libs/caffe/python:$nn/libs/py_faster_rcnn
FRCNN_PATH=$dev/py-faster-rcnn
OMP_NUM_THREADS=1
DISPLAY=localhost:1 # our default vnc
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=True
MPLBACKEND=Agg # python matplotlib
HOSTNAME=$(hostname)

tmux new-session -s $n -d -c ~/dev/$n
for i (dev nn caffe runs PYTHONPATH FRCNN_PATH OMP_NUM_THREADS DISPLAY PYTHONUNBUFFERED PYTHONDONTWRITEBYTECODE MPLBACKEND HOSTNAME) {
	tmux setenv $i ${(P)i}
}
tmux split-window -c ~/dev/$n
tmux kill-pane -t :1.1
tmux at -t $n
