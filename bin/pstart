#!/bin/zsh
set -eu -o pipefail

# see https://medium.com/njiuko/using-fzf-instead-of-dmenu-2780d184753f

out=exe-selection
env=${1:-from-list}

args=(
    -c pstart
    -t pstart
    -f 'C64 Pro Mono:size=12:antialias=true:autohint=true'
    -C 2
    -g '50x50+1200+100'
)
# TODO switch to alacritty?
st $args -e ${0:a:h}/../i/pstart/menu $out $env

if [[ -f $out ]]; then
    selection=($(cat $out))
    rm $out
    case $selection[1] in
        (enter)
            # we start in place, invisible, no terminal
            exec $selection[2]
            ;;
        (ctrl-t)
            # start in another foreground floating terminal to see the output of the command
            st $args -e =zsh -c "$selection[2]; read"
            ;;
        (*)
            echo 'unknown fzf selection:' $selection
            exit 1
            ;;
    esac
fi
