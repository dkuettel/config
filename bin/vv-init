#!/bin/zsh
set -eux -o pipefail

# - create a new virtualenv at first argument or .venv
# - install pip-tools
# - disable dropbox sync for venv

at=${1:-.venv}

if [[ -v VIRTUAL_ENV ]]; then
    echo "A virtual env at $VIRTUAL_ENV is already active." >&2
    exit 1
fi

if [[ -e $at ]]; then
    echo "The folder $at already exists." >&2
    exit 1
fi

mkdir $at
# disable dropbox upload, but indexing still happens (takes cpu time)
attr -s com.dropbox.ignored -V 1 $at
python3.9 -m venv --clear --upgrade-deps $at
$at/bin/pip install --upgrade pip pip-tools
