#!/bin/zsh
set -eux -o pipefail

# todo thumb button sends some keycombination probably thru
# its virtual keyboard adapter, can we catch this and make it something else?
# (its not mouse)

# probably need
# sudo apt install x11-utils xautomation xbindkeys xkbset

mouse=$(xinput --list --id-only 'pointer:Logitech M720 Triathlon')

# todo not sure which one to use for middle mouse button, both enabled currently
keys=(
    1   # 1 left click
    0   # 2 wheel click
    3   # 3 right click
    4   # 4 wheel forward
    5   # 5 wheel backward
    8   # 6 wheel tilt left
    9   # 7 wheel tilt right
    10  # 8 thumb backward
    2   # 9 thumb forward
)
#xinput --set-button-map $mouse $(seq 20)
xinput --set-button-map $mouse $keys

#xset m 0 0  # should be linear model for mouse, exponential would be '3 0' or so
xinput --set-prop $mouse 'libinput Accel Profile Enabled' 1 0
xinput --set-prop $mouse 'libinput Accel Speed' 0

# todo works but maps keys, not shortcuts/combinations
#xkbset m  # to allow mouse keycodes, todo ok? what about xkbset exp =m
#xmodmap -e 'keycode 37 = Pointer_Button2 NoSymbol Pointer_Button2'
#xmodmap -e 'keycode 37 = Control_L NoSymbol Control_L'

# todo insert (fn) button sends no code
# todo eject button can be used as modifier?

# for testing keep it in foreground
# could also be done globally if we dont need it per mouse type
xbindkeys -n -f =(cat << 'eof'

"xte 'keydown Control_R' 'key w' 'sleep 0.05' 'keyup Control_R'"
    b:10

# somehow super + w doesnt work
# not even what xbindkeys --key says (Mod2+Mod4 + Super_L) works
"xte 'mouseclick 2'"
    Alt + w

eof
)
